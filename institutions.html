<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Counselor Portal | Institutional Oversight</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body { 
    padding: 2rem 1rem; 
    font-family: 'Segoe UI', sans-serif; 
    background: linear-gradient(rgba(15,23,42,.85),rgba(15,23,42,.85)),
                url("static/images/bg.png") center/cover fixed no-repeat;
  }

  .glass-panel {
    max-width: 1200px;
    margin: auto;
    background: rgba(255,255,255,0.98);
    padding: 2.5rem;
    border-radius: 24px;
    box-shadow: 0 20px 50px rgba(0,0,0,.5);
  }

  .stat-card {
    background: #fff;
    border-radius: 16px;
    padding: 1.5rem;
    border-left: 6px solid #3b82f6;
    transition: .3s;
  }
  .stat-card:hover { transform: translateY(-5px); }

  .chart-container {
    background: #f8fafc;
    border-radius: 16px;
    padding: 1.5rem;
  }

  .meal-badge {
    font-size: .75rem;
    padding: .4rem .8rem;
    border-radius: 20px;
  }
</style>
</head>

<body>

<div class="glass-panel">

  <div class="d-flex justify-content-between mb-4">
    <div>
      <h2 class="fw-bold">Counselor Dashboard</h2>
      <p class="text-muted mb-0">Institutional Attendance & Mid-Day Meal Analytics</p>
    </div>
    <a href="/" class="btn btn-outline-secondary rounded-pill">‚Üê Back</a>
  </div>

  <!-- SELECT SCHOOL -->
  <div class="row g-3 mb-4 bg-light p-4 rounded-4">
    <div class="col-md-9">
      <label class="fw-bold">Select Institution</label>
      <select id="schoolSelect" class="form-select form-select-lg">
        <option value="">Select School...</option>
        <option value="greenwood">Greenwood Public School</option>
        <option value="xavier">St. Xavier's Academy</option>
        <option value="model">Model Government School</option>
        <option value="city">City International High</option>
        <option value="vanguard">Vanguard Primary Institute</option>
      </select>
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button class="btn btn-dark btn-lg w-100" onclick="analyze()">Analyze Records</button>
    </div>
  </div>

  <!-- ANALYTICS -->
  <div id="analytics" style="display:none">

    <div class="row g-4 mb-4">
      <div class="col-md-3"><div class="stat-card"><small>Avg Attendance</small><h2 id="avgAtt"></h2></div></div>
      <div class="col-md-3"><div class="stat-card border-success"><small>Total Students</small><h2 id="totalStu"></h2></div></div>
      <div class="col-md-3"><div class="stat-card border-warning"><small>Meals Served</small><h2 id="meals"></h2></div></div>
      <div class="col-md-3"><div class="stat-card border-danger"><small>Risk Alerts</small><h2 id="alerts"></h2></div></div>
    </div>

    <div class="row g-4 mb-4">
      <div class="col-lg-7">
        <div class="chart-container">
          <h5 class="fw-bold mb-3">Weekly Attendance vs Meals</h5>
          <canvas id="chart"></canvas>
        </div>
      </div>
      <div class="col-lg-5">
        <div class="card shadow-sm h-100 rounded-4">
          <div class="card-body">
            <h5 class="fw-bold">Key Insights</h5>
            <ul id="insights" class="list-group list-group-flush mt-3"></ul>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="placeholder" class="text-center py-5 text-muted">
    <h4>Select a school to view analytics</h4>
    <p>Education counselors can monitor attendance & nutrition compliance.</p>
  </div>

</div>

<script>
const schoolData = {
  greenwood: {
    avg: "94%",
    students: 1280,
    meals: 1225,
    alerts: 6,
    attendance: [95,96,94,93,92],
    mealsData: [93,95,92,91,90],
    insights: [
      "Excellent attendance consistency",
      "Meal utilization above 95%",
      "No biometric failures detected"
    ]
  },
  xavier: {
    avg: "89%",
    students: 1040,
    meals: 960,
    alerts: 14,
    attendance: [90,88,87,89,91],
    mealsData: [85,84,83,86,88],
    insights: [
      "Attendance dropped in Class 9",
      "Meal wastage detected",
      "Recommend parental counseling"
    ]
  },
  model: {
    avg: "82%",
    students: 1560,
    meals: 1420,
    alerts: 32,
    attendance: [84,82,80,83,81],
    mealsData: [88,86,84,85,83],
    insights: [
      "High absenteeism risk",
      "Meal dependency very high",
      "Government intervention advised"
    ]
  },
  city: {
    avg: "91%",
    students: 980,
    meals: 900,
    alerts: 9,
    attendance: [92,91,90,93,89],
    mealsData: [90,91,89,92,88],
    insights: [
      "Urban migration impact noticed",
      "Stable meal distribution",
      "AI recognition accuracy high"
    ]
  },
  vanguard: {
    avg: "96%",
    students: 640,
    meals: 630,
    alerts: 2,
    attendance: [97,96,95,96,94],
    mealsData: [96,97,95,96,94],
    insights: [
      "Best performing institute",
      "Almost zero absenteeism",
      "Ideal benchmark school"
    ]
  }
};

let chart;

function analyze() {
  const key = document.getElementById("schoolSelect").value;
  if (!key) return;

  const d = schoolData[key];
  document.getElementById("placeholder").style.display = "none";
  document.getElementById("analytics").style.display = "block";

  avgAtt.innerText = d.avg;
  totalStu.innerText = d.students;
  meals.innerText = d.meals;
  alerts.innerText = d.alerts;

  insights.innerHTML = "";
  d.insights.forEach(i => insights.innerHTML += `<li class="list-group-item">${i}</li>`);

  if (chart) chart.destroy();
  chart = new Chart(document.getElementById("chart"), {
    type: 'line',
    data: {
      labels: ['Mon','Tue','Wed','Thu','Fri'],
      datasets: [
        { label:'Attendance %', data:d.attendance, borderColor:'#3b82f6', tension:.4 },
        { label:'Meals %', data:d.mealsData, borderColor:'#10b981', tension:.4 }
      ]
    },
    options:{ responsive:true, plugins:{ legend:{ position:'bottom' } } }
  });
}
</script>

</body>
</html>
